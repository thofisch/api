



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.2">
    
    
      
        <title>Content Negotiation - API Design Guidelines</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../stylesheets/critic.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#content-negotiation-conneg" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="API Design Guidelines" class="md-header-nav__button md-logo">
          
            <i class="md-icon">code</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              API Design Guidelines
            </span>
            <span class="md-header-nav__topic">
              Content Negotiation
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="API Design Guidelines" class="md-nav__button md-logo">
      
        <i class="md-icon">code</i>
      
    </a>
    API Design Guidelines
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../apis/" title="APIs" class="md-nav__link">
      APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../api-design/" title="API Design" class="md-nav__link">
      API Design
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rest/" title="REST" class="md-nav__link">
      REST
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../http/" title="HTTP" class="md-nav__link">
      HTTP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../resource-identifiers/" title="Resource Identifiers" class="md-nav__link">
      Resource Identifiers
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../resources/" title="Resources" class="md-nav__link">
      Resources
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../methods/" title="Methods" class="md-nav__link">
      Methods
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../representations/" title="Representations" class="md-nav__link">
      Representations
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../hypermedia/" title="Hypermedia" class="md-nav__link">
      Hypermedia
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Content Negotiation
      </label>
    
    <a href="./" title="Content Negotiation" class="md-nav__link md-nav__link--active">
      Content Negotiation
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#server-driven-negotiation" title="Server-Driven Negotiation" class="md-nav__link">
    Server-Driven Negotiation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content-type-negotiation" title="Content Type Negotiation" class="md-nav__link">
    Content Type Negotiation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#language-negotiation" title="Language Negotiation" class="md-nav__link">
    Language Negotiation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#character-encoding-negotiation" title="Character Encoding Negotiation" class="md-nav__link">
    Character Encoding Negotiation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supporting-compression" title="Supporting Compression" class="md-nav__link">
    Supporting Compression
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-vary-header" title="The Vary Header" class="md-nav__link">
    The Vary Header
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#negotiation-failures" title="Negotiation Failures" class="md-nav__link">
    Negotiation Failures
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-driven-content-negotiation" title="Agent-Driven Content Negotiation" class="md-nav__link">
    Agent-Driven Content Negotiation
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../caching/" title="Caching" class="md-nav__link">
      Caching
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../versioning-and-extensibility/" title="Versioning and Extensibility" class="md-nav__link">
      Versioning and Extensibility
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../documentation-and-discovery/" title="Documentation and Discovery" class="md-nav__link">
      Documentation and Discovery
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../mocking/" title="-Mocking" class="md-nav__link">
      -Mocking
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../clients/" title="Clients" class="md-nav__link">
      Clients
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../throttling/" title="Throttling" class="md-nav__link">
      Throttling
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../references/" title="References" class="md-nav__link">
      References
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../examples/" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#server-driven-negotiation" title="Server-Driven Negotiation" class="md-nav__link">
    Server-Driven Negotiation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content-type-negotiation" title="Content Type Negotiation" class="md-nav__link">
    Content Type Negotiation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#language-negotiation" title="Language Negotiation" class="md-nav__link">
    Language Negotiation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#character-encoding-negotiation" title="Character Encoding Negotiation" class="md-nav__link">
    Character Encoding Negotiation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supporting-compression" title="Supporting Compression" class="md-nav__link">
    Supporting Compression
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-vary-header" title="The Vary Header" class="md-nav__link">
    The Vary Header
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#negotiation-failures" title="Negotiation Failures" class="md-nav__link">
    Negotiation Failures
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-driven-content-negotiation" title="Agent-Driven Content Negotiation" class="md-nav__link">
    Agent-Driven Content Negotiation
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="content-negotiation-conneg">Content Negotiation (conneg)<a class="headerlink" href="#content-negotiation-conneg" title="Permanent link">&para;</a></h1>
<p>There are two types of content negotiation:</p>
<ul>
<li><em>Server-driven</em> negotiation, uses request HTTP headers to select a variant.</li>
<li><em>Agent-driven</em> negotiation, uses a distinct URI for each variant.</li>
</ul>
<h2 id="server-driven-negotiation">Server-Driven Negotiation<a class="headerlink" href="#server-driven-negotiation" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>DO</strong> support multiple variants only when your clients need them.</li>
<li><strong>DO</strong> support multiple variants only when each variant contains the same information.</li>
<li><strong>DO NOT</strong> use server-driven negotiation when the information content is different, use <a href="#agent-driven-content-negotiation">Agent-Driven Content Negotiation</a> instead.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Indicating Client Preferences</p>
<p>It is important for the client to indicate its preferences and capabilities to the server, including:</p>
<ul>
<li>representation formats</li>
<li>languages</li>
<li>character encoding</li>
<li>support for compression.</li>
</ul>
<p>Even if you know this information out of band, clearly indicating the client's preferences and capabilities can help in the face of change. It is better to ask for a specific representation instead of getting a default one, because the default can change.</p>
</div>
<h3 id="content-type-negotiation">Content Type Negotiation<a class="headerlink" href="#content-type-negotiation" title="Permanent link">&para;</a></h3>
<span class="critic comment">content negotiation (include or exclude and force to e.g. json)?</span>
<ul>
<li><strong>DO</strong> return a representation using the default format, if the request has no <code>Accept</code> header.</li>
<li><strong>DO</strong> parse the <code>Accept</code> header, sort the values of media types by the <code>q</code> parameters in descending order, if the request has an <code>Accept</code> header, then select a media type from the list that the server supports.</li>
<li><ins class="critic"><strong>DO</strong> return a representation using the default format, if the server does not support any format in the list, and the <code>Accept</code> header does not contain <code>*;q=0.0</code>.</ins><span class="critic comment">Is this correct for the Content-Type HTTP header?</span></li>
<li><strong>DO</strong> handle <a href="#negotiation-failures">content negotiation failures</a> to determine an appropriate response.</li>
<li><strong>CONSIDER</strong> including a <code>Vary</code> (see <a href="#the-vary-header">Vary</a>) response header.</li>
<li><strong>CONSIDER</strong> using <a href="#agent-driven-negotiation"><em>agent-driven negotiation</em></a>, if the server starts out ignoring <code>Accept</code>, and, for example, returns <code>Content-Type: application/xml</code> for <code>Accept: application/json</code> requests. Later on , adding content negotiation (<code class="codehilite"><span class="err">Content-Type: application/json</span></code>) will likely break compatibility for working clients.</li>
</ul>
<h3 id="language-negotiation">Language Negotiation<a class="headerlink" href="#language-negotiation" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>DO</strong> return a representation with all human-readable text in a default language, if the request has no <code>Accept-Language</code> header.</li>
<li><strong>DO</strong> parse the <code>Accept-Language</code> header, sort the languages by the <code>q</code> parameters in descending order, and select the first language in the list that the server can support, if the request has an <code>Accept-Language</code> header</li>
<li><strong>DO</strong> use a default language for the response, if the server does not support any languages in the list, and the <code>Accept-Language</code> header does not contain <code>*;q=0.0</code>.</li>
<li><strong>CONSIDER</strong> including a <code>Vary</code> (see <a href="#the-vary-header">The Vary Header</a>) response header.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This approach is best suited when representations in different languages differ only in terms of the language used for any human-readable text. If the differences between representations are more significant, use other means of localization such as the client's IP address or region/language-specific URIs.</p>
</div>
<h3 id="character-encoding-negotiation">Character Encoding Negotiation<a class="headerlink" href="#character-encoding-negotiation" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>DO</strong> encode the textual representation of the response using the encoding the client ask for via the <code>Accept-Charset</code> header. Encoding the response using that encoding promotes interoperability.</li>
<li><strong>DO</strong> parse the header, sort the character set by the <code>q</code> parameters in descending order, and select the first character set that the server can support for encoding.</li>
<li><strong>DO</strong> return a representation using <code>UTF-8</code> encoding, if the request has no <code>Accept-Charset</code> header.</li>
<li><strong>DO</strong> return a representation using <code>UTF-8</code> encoding, if the server does not support any requested character set and the <code>Accept-Charset</code> header does not contain <code>*;q=0.0</code>.</li>
<li><strong>DO</strong> include the <code>charset</code> parameter in the <code>Content-Type</code> header, in all cases, if the media type is textual and allows a <code>charset</code> parameter.</li>
<li><strong>CONSIDER</strong> including a <code>Vary</code> (see <a href="#the-vary-header">The Vary Header</a>) response header.</li>
<li><strong>AVOID</strong> using <code>text/xml</code> since its default encoidng is <code>us-ascii</code>.</li>
</ul>
<h3 id="supporting-compression">Supporting Compression<a class="headerlink" href="#supporting-compression" title="Permanent link">&para;</a></h3>
<p>To support compression or <em>content encoding</em>:</p>
<ul>
<li><strong>DO</strong> use the compression technique from the <code>Accept-Encoding</code> header, if the server is capable of compressing the response body.</li>
<li><strong>DO</strong> parse the header, sort the character set by the <code>q</code> parameters in descending order, and select the first content encoding the server supports.</li>
<li><strong>DO</strong> ignore this header, if no encoding in this header matches the server's supported encodings.</li>
<li><strong>CONSIDER</strong> including a <code>Vary</code> (see <a href="#the-vary-header">The Vary Header</a>) response header.</li>
<li><strong>CONSIDER</strong> brotli (<code>br</code>).</li>
<li><strong>DO NOT</strong> compress representations, if the request has no <code>Accept-Encoding</code> header.</li>
</ul>
<h3 id="the-vary-header">The <code>Vary</code> Header<a class="headerlink" href="#the-vary-header" title="Permanent link">&para;</a></h3>
<p>When a server uses content negotiation to select a representation, the same URI can yield different representations based on <code>Accept-*</code> headers. The <code>Vary</code> header tells clients which request headers the server used when selecting a representation. Caches may use the <code>Vary</code> header as part of cache keys to maintain variants of a resource.</p>
<ul>
<li><strong>CONSIDER</strong> including a <code>Vary</code> header whenever multiple representations are available for a resource. The value of this header is a comma-separated list of <em>request headers</em> the server used when choosing representation.</li>
<li><strong>CONSIDER</strong> including a <code>Vary</code> header with a value of <code>*</code>, if the server uses information other than the headers in the request, such as a client's IP address, time of day, user personalization, etc.</li>
</ul>
<h3 id="negotiation-failures">Negotiation Failures<a class="headerlink" href="#negotiation-failures" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>DO</strong> return <code>406 Not Acceptable</code> with either the body of the representation containing the list of representations, or a <code>Link</code> in the header, when the server cannot serve a representation that meets the client's preferences and if the client explicitly included a <code>*;q=0.0</code>.</li>
<li><strong>DO</strong> serve the representation without applying any content encoding, if the server is unable to support the requested <code>Accept-Encoding</code> value.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Servers are free to serve any available representation for a given resource. However, clients may not be able to handle arbitrary media types.</p>
</div>
<h2 id="agent-driven-content-negotiation">Agent-Driven Content Negotiation<a class="headerlink" href="#agent-driven-content-negotiation" title="Permanent link">&para;</a></h2>
<p>Although server-driven content negotiation is built into HTTP it does not include elements such as currency units, distance units, date formats, and other regional flavors for any human-readable text in representations.</p>
<p>In some cases, because of complex localization requirements, the server may decide to maintain different resources for different locales.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Agent-driven negotiation simply mean providing distinct URIs for each variant and allow the client to use that URI to select the desired representation.</p>
</div>
<ul>
<li><strong>DO</strong> use out-of-band information from the server to determine which URI to use. If the representation exists, the server returns it, if not, it return <code>404 Not Found</code>.</li>
<li><strong>CONSIDER</strong> using agent-driven negotiation, when the client cannot communicate its preferences using <code>Accept-*</code> headers, using one or more of these common approaches:<ul>
<li>Query parameters, like <code>https://www.example.org/status?format={format}</code></li>
<li>URI extensions, appending a dot (<code>.</code>) and a shorthand media type to the base URI. Like <code>https://www.example.org/status.json</code></li>
<li>Subdomains, like <code>https://dk.example.org/status</code></li>
</ul>
</li>
<li><strong>CONSIDER</strong> letting the server advertise alternatives using links with the <code>alternate</code> link relation type.</li>
</ul>
<p>Although it is possible to implement agent-driven negotiation for all <code>Accept-*</code> headers, in practice it is most commonly used for media types and languages.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../hypermedia/" title="Hypermedia" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Hypermedia
              </span>
            </div>
          </a>
        
        
          <a href="../caching/" title="Caching" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Caching
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.267712eb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>