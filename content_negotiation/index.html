<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>-Content Negotiation - API Design Guidelines</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "-Content Negotiation";
    var mkdocs_page_input_path = "content_negotiation.md";
    var mkdocs_page_url = "/content_negotiation/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> API Design Guidelines</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../apis/">-APIs</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../rest/">-REST</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../http/">-HTTP</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../resource_identifiers/">-Resource Identifiers</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../resources/">-Resources</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../methods/">-Methods</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../representations/">---Representations</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../hypermedia/">---Hypermedia</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">-Content Negotiation</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#content-negotiation-conneg">Content Negotiation (conneg)</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#server-driven-negotiation">Server-Driven Negotiation</a></li>
        
            <li><a class="toctree-l3" href="#agent-driven-content-negotiation">Agent-Driven Content Negotiation</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../caching/">---Caching</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../security/">---Security</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../versioning_and_extensibility/">---Versioning and Extensibility</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../documentation_and_discovery/">---Documentation and Discovery</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../specifications/">---Specifications</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../mocking/">---Mocking</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../clients/">---Clients</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../other_topics/">---Other topics</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../misc/">---Misc</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../references/">-References</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">API Design Guidelines</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>-Content Negotiation</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="content-negotiation-conneg">Content Negotiation (conneg)</h2>
<p>There are two types of content negotiation:</p>
<ul>
<li><em>Server-driven</em> negotiation, uses request headers to select a variant</li>
<li><em>Agent-driven</em> negotiation, uses a distinct URI for each variant</li>
</ul>
<h3 id="server-driven-negotiation">Server-Driven Negotiation</h3>
<ul>
<li><strong>DO</strong> support multiple variants only when your clients need them.</li>
<li><strong>DO</strong> support multiple variants only when each variant contains the same information</li>
<li><strong>DO NOT</strong> use server-driven negotiation when the information content is different, use <a href="#agent-driven-content-negotiation">Agent-Driven Content Negotiation</a> instead.</li>
</ul>
<h4 id="indicating-client-preferences">Indicating Client Preferences</h4>
<p>It is important for the client to indicate its preferences and capabilities to the server, including:</p>
<ul>
<li>representation formats</li>
<li>languages</li>
<li>character encoding</li>
<li>support for compression.</li>
</ul>
<p>Even when you know out of band this information, clearly indicating the client's preferences and capabilities can help the client in the face of change. It is better to ask for a specific representation instead of getting a default one, because the default can change.</p>
<h4 id="content-type-negotiation">Content Type Negotiation</h4>
<p><em>content negotiation (include or exclude and force to e.g. json)?</em></p>
<ul>
<li><strong>DO</strong> add an <code>Accept</code> header with a comma-separated list of media type preferences. If the client prefers one media type over the other, add a <code>q</code> parameter with each media type.</li>
<li><strong>DO</strong> add <code>*;q=0.0</code> in the <code>Accept</code> header to indicate to the server it cannot process anything other than the media types listed in the <code>Accept</code> header, if the client can process only certain formats.</li>
<li><strong>DO</strong> return a representation using the default format, if the request has no <code>Accept</code> header.</li>
<li><strong>DO</strong> parse the header, sort the values of media types by the <code>q</code> parameters in descending order, if the request has an <code>Accept</code> header, then select a media type from the list that the server supports.</li>
<li><strong>DO</strong> handle <a href="#negotiation-failures">content negotiation failures</a> to determine an appropriate response</li>
<li><strong>CONSIDER</strong> including a <code>Vary</code> (see <a href="#the-vary-header">Vary</a>) response header.</li>
<li><strong>CONSIDER</strong> using <a href="#agent-driven-negotiation"><em>agent-driven negotiation</em></a>, if the server starts out ignoring <code>Accept</code>, e.g. by returning <code>Content-Type: application/xml</code> for <code>Accept: application/json</code> requests, adding content negotiation (here by adding <code>Content-Type: application/json</code>) will likely break compatibility for working clients.</li>
</ul>
<h4 id="language-negotiation">Language Negotiation</h4>
<ul>
<li><strong>DO</strong> add an <code>Accept-Language</code> header for the preferred language of the representation.</li>
<li><strong>DO</strong> return a representation with all human-readable text in a default language, if the request has no <code>Accept-Language</code> header.</li>
<li><strong>DO</strong> parse the header, sort the languages by the <code>q</code> parameters in descending order, and select the first language in the list that the server can support, if the request has an <code>Accept-Language</code> header</li>
<li><strong>DO</strong> use a default language for the response, if the server does not support any languages in the list, and the <code>Accept-Language</code> header does not contain <code>*;q=0.0</code>.</li>
<li><strong>CONSIDER</strong> including a <code>Vary</code> (see <a href="#the-vary-header">The Vary Header</a>) response header.</li>
</ul>
<p>This approach is best suited when representations in different languages differ only in terms of the language used for any human-readable text. If the differences between representations are more significant, use other means of localization such as the client's IP address or region/language-specific URIs.</p>
<h4 id="character-encoding-negotiation">Character Encoding Negotiation</h4>
<ul>
<li><strong>DO</strong> add an <code>Accept-Charset</code> header with the preferred character set, if the client can process characters of a specific character set only, if not, avoid adding this header</li>
<li><strong>DO</strong> encode the textual representation of the response using the encoding the client ask for via the <code>Accept-Charset</code> header. Encoding the response using that encoding promotes interoperability.</li>
<li><strong>DO</strong> return a representation using <code>UTF-8</code> encoding, if the request has no <code>Accept-Charset</code> header.</li>
<li><strong>DO</strong> parse the header, sort the character set by the <code>q</code> parameters in descending order, and select the first character set that the server can support for encoding.</li>
<li><strong>DO</strong> return a representation using <code>UTF-8</code> encoding, if the server does not support any requested character set and the <code>Accept-Charset</code> header does not contain <code>*;q=0.0</code>.</li>
<li><strong>DO</strong> include the <code>charset</code> parameter in the <code>Content-Type</code> header, in all cases, if the media type is textual and allows a <code>charset</code> parameter.</li>
<li><strong>CONSIDER</strong> including a <code>Vary</code> (see <a href="#the-vary-header">The Vary Header</a>) response header.</li>
<li><strong>AVOID</strong> using <code>text/xml</code> since its default encoidng is <code>us-ascii</code>.</li>
</ul>
<h4 id="supporting-compression">Supporting Compression</h4>
<p>To support compression or <em>content encoding</em>:</p>
<ul>
<li><strong>DO</strong> add an <code>Accept-Encoding</code> header listing the supported encodings,if the client is able to decompress representations compressed encoding such as <code>gzip</code>, <code>compress</code>, or <code>deflate</code>, add an <code>Accept-Encoding</code> header listing the supported encodings, if not, skip this header</li>
<li><strong>DO</strong> use the compression technique from the <code>Accept-Encoding</code> header, if the server is capable of compressing the response body.</li>
<li><strong>DO</strong> parse the header, sort the character set by the <code>q</code> parameters in descending order, and select the first content encoding the server supports.</li>
<li><strong>DO</strong> ignore this header, if no encoding in this header matches the server's supported encodings.</li>
<li><strong>CONSIDER</strong> including a <code>Vary</code> (see <a href="#the-vary-header">The Vary Header</a>) response header.</li>
<li><strong>CONSIDER</strong> brotli (<code>br</code>).</li>
<li><strong>DO NOT</strong> compress representations, if the request has no <code>Accept-Encoding</code> header.</li>
</ul>
<h4 id="the-vary-header">The Vary Header</h4>
<p>When a server uses content negotiation to select a representation, the same URI can yield different representations based on <code>Accept-*</code> headers. The <code>Vary</code> header tells clients which request headers the server used when selecting a representation. Caches may use the <code>Vary</code> header as part of cache keys to maintain variants of a resource.</p>
<ul>
<li><strong>CONSIDER</strong> including a <code>Vary</code> header whenever multiple representations are available for a resource. The value of this header is a comma-separated list of <em>request headers</em> the server uses when choosing representation.</li>
<li><strong>CONSIDER</strong> including a <code>Vary</code> header with a value of <code>*</code>, if the server uses information other then the headers in the request, such as a client's IP address, time of day, user personalization, etc.</li>
</ul>
<h4 id="negotiation-failures">Negotiation Failures</h4>
<ul>
<li><strong>CONSIDER</strong> that servers are free to serve any available representation for a given resource. However, clients may not be able to handle arbitrary media types.</li>
<li><strong>DO</strong> return <code>406 Not Acceptable</code> with either the body of the representation containing the list of representations, or a <code>Link</code> in the header, when the server cannot serve a representation that meets the client's preferences and if the client explicitly included a <code>*;q=0.0</code>.</li>
<li><strong>DO</strong> serve the representation without applying any content encoding, if the server is unable to support the requested <code>Accept-Encoding</code> value.</li>
</ul>
<h3 id="agent-driven-content-negotiation">Agent-Driven Content Negotiation</h3>
<p>Although server-driven content negotiation is built into HTTP it does not include elements such as currency units, distance units, date formats, and other regional flavors for any human-readable text in representations.</p>
<p>In some cases, because of complex localization requirements, the server may decide to maintain different resources for different locales.</p>
<p>Agent-driven negotiation simply mean providing distinct URIs for each variant and allow the client to use that URI to select the desired representation.</p>
<ul>
<li><strong>DO</strong> use out-of-band information from the server to determine which URI to use. If the representation exists, the server returns it, if not, it return <code>404 Not Found</code>.</li>
<li><strong>CONSIDER</strong> using agent-driven negotiation, when the client cannot communicate its preferences using <code>Accept-*</code> headers, using one or more of these common approaches:<ul>
<li>Query parameters, like <code>http://www.example.org/status?format={format}</code></li>
<li>URI extensions, appending a dot (<code>.</code>) and a shorthand media type to the base URI. Like <code>http://www.example.org/status.json</code></li>
<li>Subdomains, like <code>http://dk.example.org/status</code></li>
</ul>
</li>
<li><strong>CONSIDER</strong> letting the server advertise alternatives using links with the <code>alternate</code> link relation type.</li>
</ul>
<p>Although it is possible to implement agent-driven negotiation for all <code>Accept-*</code> headers, in practice it is most commonly used for media types and languages.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../caching/" class="btn btn-neutral float-right" title="---Caching">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../hypermedia/" class="btn btn-neutral" title="---Hypermedia"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../hypermedia/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../caching/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
